{% extends "purple_robot_base.html" %}
{% block 'title' %}Purple Robot Test Results{% endblock %}
{% block 'content' %}
	<div class="col-md-12">
		<h1>Purple Robot Probe Test</h1>
		
		<p>User Hash: <a href="{% url 'tests_by_user' test.user_id %}">{{ test.user_id }}</a></p>
		<p>Probe: {{ test.probe }}</p>
		
		{% with observed=test.average_frequency %}
			<p>Target Frequency: {{ test.frequency }} Hz</p>
			<p>Observed Frequency: {{ observed }} Hz</p>
			<p>Target Met: {% if observed > test.frequency %}Yes{% else %}No{% endif %}</p>
			<p>Max Sample Gap: {{ test.max_gap_size }}</p>
			<p>Last Sample Recorded: {{ test.last_recorded_sample }}</p>
		{% endwith %}
		
		<h2>Frequency Timeline (Last 24 Hours)</h2>
		<div id="chart_container" style="vertical-align: top;">
        	<div id="y_axis" style="width: 40px; height: 240px; float: left; display: inline-block;"></div>
	        <div id="chart" style="display: inline-block;""></div>
    	</div>    
		<script>
			// set up our data series with 50 random data points

			// instantiate our graph!

			var graph = new Rickshaw.Graph( {
				element: document.getElementById("chart"),
				height: 240,
				width: 920,
				renderer: 'line',
				series: [
					{
						color: "#c05020",
						data: {{ test.frequency_graph_json|safe }},
						name: 'Samples per 15 minutes'
					}
				],
				padding: { top: 0.25 }
			});
			
			var x_axis = new Rickshaw.Graph.Axis.Time( { graph: graph } );

			var y_axis = new Rickshaw.Graph.Axis.Y( {
		        graph: graph,
        		orientation: 'left',
		        tickFormat: Rickshaw.Fixtures.Number.formatKMBT,
		        element: document.getElementById('y_axis'),
			});

			var hoverDetail = new Rickshaw.Graph.HoverDetail( {
			    graph: graph,
			    xFormatter: function(x) 
			    { 
			    	var date = new Date (x * 1000);
			    	return "" + date 
			    },
			    yFormatter: function(y) { return Math.floor(y) + " samples" }
			});

			graph.render();
		</script>
	</div>
{% endblock %}

{% block 'page_script' %}
	$(document).ready(function() {
		$("li#header_probe").addClass("active");
	});
{% endblock %}
